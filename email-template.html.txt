<!DOCTYPE html>
<html>
<head>
    <title>Monthly Performance Report</title>
</head>
<body style="font-family: 'Inter', sans-serif; margin: 0; padding: 0; background-color: #F0F8F5; color: #111827;">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="background-color: #F0F8F5;">
        <tr>
            <td align="center">
                <table width="800" border="0" cellspacing="0" cellpadding="20" style="background-color: #FFFFFF; margin: 30px auto; border-radius: 12px; border: 1px solid #E5E7EB;">
                    <!-- Header -->
                    <tr>
                        <td style="text-align: center; border-bottom: 1px solid #E5E7EB; padding-bottom: 20px;">
                            <h1 style="margin: 0; font-size: 2.2em; font-weight: 800; color: #00B14F;">Monthly Performance Report</h1>
                            <p style="margin: 5px 0 0; color: #6B7280; font-size: 1.1em;">For the period: <?= startDate ?> to <?= endDate ?></p>
                        </td>
                    </tr>

                    <!-- Scorecards -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Task Summary</h2>
                            <? var scorecards = productionSummary.totalCounts; ?>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10">
                                <tr>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Completed</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards.Completed || 0 ?></div>
                                    </td>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">In Progress</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards['In Progress'] || 0 ?></div>
                                    </td>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Escalated</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards.Escalated || 0 ?></div>
                                    </td>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Grand Total</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards.GrandTotal || 0 ?></div>
                                    </td>
                                </tr>
                                <tr style="height: 10px;"><td colspan="4"></td></tr>
                                <tr>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Not Started</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards['Not Started'] || 0 ?></div>
                                    </td>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Cancelled</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards.Cancelled || 0 ?></div>
                                    </td>
                                    <td align="center" style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 15px;">
                                        <div style="font-size: 1em; font-weight: 600; color: #6B7280;">Task Paused</div>
                                        <div style="font-size: 2.5em; font-weight: 700; color: #111827;"><?= scorecards['Task Paused'] || 0 ?></div>
                                    </td>
                                    <td></td> <!-- Empty cell for alignment -->
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Task Count by Market -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Task Count by Market</h2>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Country</td>
                                    <td>Cancelled</td><td>Completed</td><td>Escalated</td><td>In Progress</td><td>Not Started</td><td>Task Paused</td>
                                </tr>
                                <? for (var market in productionSummary.marketCounts) { ?>
                                    <tr>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market].Cancelled || 0 ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market].Completed || 0 ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market].Escalated || 0 ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market]['In Progress'] || 0 ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market]['Not Started'] || 0 ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= productionSummary.marketCounts[market]['Task Paused'] || 0 ?></td>
                                    </tr>
                                <? } ?>
                            </table>
                            <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:marketChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- TAT Adherence by Market -->
                    <tr>
                        <td>
                             <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">TAT Adherence by Market</h2>
                             <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Market</td>
                                    <td>TAT Adhered</td><td>TAT Missed</td><td>Grand Total</td>
                                </tr>
                                <?  var tatGrandTotal = { adhered: 0, missed: 0, total: 0 };
                                    for (var market in productionSummary.tatCounts) {
                                    var adhered = productionSummary.tatCounts[market].adhered || 0;
                                    var missed = productionSummary.tatCounts[market].missed || 0;
                                    tatGrandTotal.adhered += adhered;
                                    tatGrandTotal.missed += missed;
                                    tatGrandTotal.total += adhered + missed;
                                ?>
                                    <tr>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= adhered ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= missed ?></td>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= adhered + missed ?></td>
                                    </tr>
                                <? } ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <td style="padding: 12px 15px;"><?= tatGrandTotal.adhered ?></td>
                                    <td style="padding: 12px 15px;"><?= tatGrandTotal.missed ?></td>
                                    <td style="padding: 12px 15px;"><?= tatGrandTotal.total ?></td>
                                </tr>
                             </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:tatChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- TAT Bucket -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">TAT Bucket</h2>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Country</td>
                                    <td>&lt;24h</td><td>24-30h</td><td>30-48h</td><td>&gt;48h</td><td>Total</td>
                                </tr>
                                <? for (var market in productionSummary.tatBucket.marketData) { var data = productionSummary.tatBucket.marketData[market]; ?>
                                <tr>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= data.under24 || 0 ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= data.between24and30 || 0 ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= data.between30and48 || 0 ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= data.over48 || 0 ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= data.total || 0 ?></td>
                                </tr>
                                <? } ?>
                                <? var tatBucketTotal = productionSummary.tatBucket.grandTotal; ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <td style="padding: 12px 15px;"><?= tatBucketTotal.under24 || 0 ?></td>
                                    <td style="padding: 12px 15px;"><?= tatBucketTotal.between24and30 || 0 ?></td>
                                    <td style="padding: 12px 15px;"><?= tatBucketTotal.between30and48 || 0 ?></td>
                                    <td style="padding: 12px 15px;"><?= tatBucketTotal.over48 || 0 ?></td>
                                    <td style="padding: 12px 15px;"><?= tatBucketTotal.total || 0 ?></td>
                                </tr>
                            </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:tatBucketChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- Menu Complexity -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Menu Complexity Analysis</h2>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Country</td>
                                    <td>Avg. AHT</td><td>Avg. Dishes</td><td>Avg. Photos</td><td>Avg. Options</td><td>Avg. Option Groups</td>
                                </tr>
                                <? for (var market in productionSummary.menuComplexity.marketData) { var data = productionSummary.menuComplexity.marketData[market]; ?>
                                <tr>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= formatDuration(data.avgAhtSeconds || 0) ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= (data.avgTotalDishes || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= (data.avgMainDishesPhotos || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= (data.avgTotalOptions || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= (data.avgTotalOptionGroups || 0).toFixed(1) ?></td>
                                </tr>
                                <? } ?>
                                <? var menuComplexityTotal = productionSummary.menuComplexity.grandTotal; ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <td style="padding: 12px 15px;"><?= formatDuration(menuComplexityTotal.avgAhtSeconds || 0) ?></td>
                                    <td style="padding: 12px 15px;"><?= (menuComplexityTotal.avgTotalDishes || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px;"><?= (menuComplexityTotal.avgMainDishesPhotos || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px;"><?= (menuComplexityTotal.avgTotalOptions || 0).toFixed(1) ?></td>
                                    <td style="padding: 12px 15px;"><?= (menuComplexityTotal.avgTotalOptionGroups || 0).toFixed(1) ?></td>
                                </tr>
                            </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:menuComplexityChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                     <!-- AHT by Month -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Average AHT per Market by Month</h2>
                            <? var monthList = productionSummary.monthList; ?>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Market</td>
                                    <? for (var i = 0; i < monthList.length; i++) { ?>
                                        <td><?= monthList[i] ?></td>
                                    <? } ?>
                                </tr>
                                <? for (var market in productionSummary.ahtByMonth.marketData) { ?>
                                    <tr>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                        <? for (var i = 0; i < monthList.length; i++) { ?>
                                            <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= formatDuration(productionSummary.ahtByMonth.marketData[market][monthList[i]] || 0) ?></td>
                                        <? } ?>
                                    </tr>
                                <? } ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <? for (var i = 0; i < monthList.length; i++) { ?>
                                        <td style="padding: 12px 15px;"><?= formatDuration(productionSummary.ahtByMonth.grandTotal[monthList[i]] || 0) ?></td>
                                    <? } ?>
                                </tr>
                            </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:ahtByMonthChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- AHT by Retailer -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Average AHT by Retailer Provider Type</h2>
                             <? var retailerTypes = productionSummary.retailerTypeList; ?>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Market</td>
                                    <? for (var i = 0; i < retailerTypes.length; i++) { ?>
                                        <td><?= retailerTypes[i] ?></td>
                                    <? } ?>
                                </tr>
                                <? for (var market in productionSummary.ahtByRetailer.marketData) { ?>
                                <tr>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= market ?></td>
                                    <? for (var i = 0; i < retailerTypes.length; i++) { ?>
                                        <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= formatDuration(productionSummary.ahtByRetailer.marketData[market][retailerTypes[i]] || 0) ?></td>
                                    <? } ?>
                                </tr>
                                <? } ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <? for (var i = 0; i < retailerTypes.length; i++) { ?>
                                        <td style="padding: 12px 15px;"><?= formatDuration(productionSummary.ahtByRetailer.grandTotal[retailerTypes[i]] || 0) ?></td>
                                    <? } ?>
                                </tr>
                            </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:ahtByRetailerChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- AHT by Category -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Average AHT by Category</h2>
                            <table width="100%" border="0" cellspacing="0" cellpadding="10" style="border: 1px solid #E5E7EB; border-radius: 8px; text-align: center;">
                                <tr style="background-color: #F0F8F5; font-weight: 700;">
                                    <td style="padding: 12px 15px; text-align: left;">Category</td>
                                    <td>Average AHT</td>
                                </tr>
                                <? for (var i = 0; i < productionSummary.categoryList.length; i++) { var category = productionSummary.categoryList[i]; ?>
                                <tr>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB; text-align: left; font-weight: 700;"><?= category ?></td>
                                    <td style="padding: 12px 15px; border-top: 1px solid #E5E7EB;"><?= formatDuration(productionSummary.ahtByCategory.categoryData[category] || 0) ?></td>
                                </tr>
                                <? } ?>
                                <tr style="font-weight: 700; border-top: 2px solid #111827;">
                                    <td style="padding: 12px 15px; text-align: left;">Grand Total</td>
                                    <td style="padding: 12px 15px;"><?= formatDuration(productionSummary.ahtByCategory.grandTotal.avgAhtSeconds || 0) ?></td>
                                </tr>
                            </table>
                             <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:ahtByCategoryChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>

                    <!-- Leaderboard -->
                    <tr>
                        <td>
                            <h2 style="font-size: 1.6em; font-weight: 700; margin: 20px 0 10px;">Top 10 Agents by Cases Completed</h2>
                            <div style="text-align: center; padding-top: 20px;">
                                <img src="cid:leaderboardChart" style="max-width: 90%;" />
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>
